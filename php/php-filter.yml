rules:
  - id: php-stream-exploit
    pattern-either:
    - patterns:
      - pattern: $METHOD($DATA,...)
      - metavariable-regex:
          metavariable: $METHOD
          regex: ^(file_get_contents|readfile|getimagesize|md5_file|sha1_file|file|parse_ini_file|copy|file_put_contents|stream_get_contents)$
      - metavariable-regex:
          metavariable: $DATA
          regex: \$\w+
    - patterns:
      - pattern: $METHOD("...",$DATA,...)
      - metavariable-regex:
          metavariable: $METHOD
          regex: ^(hash_file)$
      - metavariable-regex:
          metavariable: $DATA
          regex: \$\w+
    - patterns:
      - pattern: fopen($SOURCE,...)
      - metavariable-regex:
          metavariable: $SOURCE
          regex: \$\w+
    - patterns:
      - pattern: $CLASS::compressFile($PATH)
      - metavariable-regex:
          metavariable: $PATH
          regex: \$\w+
    message: Possibility to use exploit this function call via php://filter payload
    languages: [php]
    severity: WARNING
